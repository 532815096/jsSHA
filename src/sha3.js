/*
 A JavaScript implementation of the SHA family of hashes, as
 defined in FIPS PUB 180-2 as well as the corresponding HMAC implementation
 as defined in FIPS PUB 198a

 Copyright Brian Turek 2008-2016
 Distributed under the BSD License
 See http://caligatio.github.com/jsSHA/ for more information

 Several functions taken from Paul Johnston
*/
'use strict';(function(H){function t(c,b,d){var a=[],g=0,e,h,k,f,l,m,r,p,q=!1,n=[],t=[],u,w=!1;d=d||{};e=d.encoding||"UTF8";u=d.numRounds||1;k=z(b,e);if(u!==parseInt(u,10)||1>u)throw Error("numRounds must a integer >= 1");if(0===c.lastIndexOf("SHA3-",0))if(m=x,r=function(a,b,c,e){c=l;var g=f,h,d=[],k=c>>>5,m=0,p=b>>>5;for(h=0;h<p&&b>=c;h+=k)e=x(a.slice(h,h+k),e),b-=c;a=a.slice(h);for(b%=c;a.length<k;)a.push(0);h=b>>>3;a[h>>2]^=6<<24-h%4*8;a[k-1]^=128;for(e=x(a,e);32*d.length<g;){a=e[m%5][m/5|0];d.push((a.b&
255)<<24|(a.b&65280)<<8|(a.b&16711680)>>8|a.b>>>24);if(32*d.length>=g)break;d.push((a.a&255)<<24|(a.a&65280)<<8|(a.a&16711680)>>8|a.a>>>24);m+=1;0==64*m%c&&x(null,e)}return d},p=function(a){var b=[],c;for(c=0;5>c;c++)b[c]=a[c].slice();return b},"SHA3-224"===c)l=1152,f=224;else if("SHA3-256"===c)l=1088,f=256;else if("SHA3-384"===c)l=832,f=384;else if("SHA3-512"===c)l=576,f=512;else throw Error("Chosen SHA variant is not supported");else throw Error("Chosen SHA variant is not supported");h=v(c);this.setHMACKey=
function(a,b,g){var d;if(!0===q)throw Error("HMAC key already set");if(!0===w)throw Error("Cannot set HMAC key after calling update");e=(g||{}).encoding||"UTF8";b=z(b,e)(a);a=b.binLen;b=b.value;d=l>>>3;g=d/4-1;if(d<a/8){for(b=r(b,a,0,v(c));b.length<=g;)b.push(0);b[g]&=4294967040}else if(d>a/8){for(;b.length<=g;)b.push(0);b[g]&=4294967040}for(a=0;a<=g;a+=1)n[a]=b[a]^909522486,t[a]=b[a]^1549556828;h=m(n,h);q=!0};this.update=function(b){var c,e,d,f=0,y=l>>>5;c=k(b,a,g);b=c.binLen;e=c.value;c=b>>>5;for(d=
0;d<c;d+=y)f+l<=b&&(h=m(e.slice(d,d+y),h),f+=l);a=e.slice(f>>>5);g=b%l;w=!0};this.getHash=function(b,e){var d,k,l,m;if(!0===q)throw Error("Cannot call getHash after setting HMAC key");l=A(e);switch(b){case "HEX":d=function(a){return B(a,f,l)};break;case "B64":d=function(a){return C(a,f,l)};break;case "BYTES":d=function(a){return D(a,f)};break;case "ARRAYBUFFER":try{k=new ArrayBuffer(0)}catch(I){throw Error("ARRAYBUFFER not supported by this environment");}d=function(a){return E(a,f)};break;default:throw Error("format must be HEX, B64, BYTES, or ARRAYBUFFER");
}m=r(a.slice(),g,0,p(h));for(k=1;k<u;k+=1)m=r(m,f,0,v(c));return d(m)};this.getHMAC=function(b,e){var d,k,l,n;if(!1===q)throw Error("Cannot call getHMAC without first setting HMAC key");l=A(e);switch(b){case "HEX":d=function(a){return B(a,f,l)};break;case "B64":d=function(a){return C(a,f,l)};break;case "BYTES":d=function(a){return D(a,f)};break;case "ARRAYBUFFER":try{d=new ArrayBuffer(0)}catch(I){throw Error("ARRAYBUFFER not supported by this environment");}d=function(a){return E(a,f)};break;default:throw Error("outputFormat must be HEX, B64, BYTES, or ARRAYBUFFER");
}k=r(a.slice(),g,0,p(h));n=m(t,v(c));n=r(k,f,0,n);return d(n)}}function f(c,b){this.a=c;this.b=b}function J(c,b,d){var a=c.length,g,e,h,k,f;b=b||[0];d=d||0;f=d>>>3;if(0!==a%2)throw Error("String of HEX type must be in byte increments");for(g=0;g<a;g+=2){e=parseInt(c.substr(g,2),16);if(isNaN(e))throw Error("String of HEX type contains invalid characters");k=(g>>>1)+f;for(h=k>>>2;b.length<=h;)b.push(0);b[h]|=e<<8*(3-k%4)}return{value:b,binLen:4*a+d}}function K(c,b,d){var a=[],g,e,h,k,a=b||[0];d=d||
0;e=d>>>3;for(g=0;g<c.length;g+=1)b=c.charCodeAt(g),k=g+e,h=k>>>2,a.length<=h&&a.push(0),a[h]|=b<<8*(3-k%4);return{value:a,binLen:8*c.length+d}}function L(c,b,d){var a=[],g=0,e,h,k,f,l,m,a=b||[0];d=d||0;b=d>>>3;if(-1===c.search(/^[a-zA-Z0-9=+\/]+$/))throw Error("Invalid character in base-64 string");h=c.indexOf("=");c=c.replace(/\=/g,"");if(-1!==h&&h<c.length)throw Error("Invalid '=' found in base-64 string");for(h=0;h<c.length;h+=4){l=c.substr(h,4);for(k=f=0;k<l.length;k+=1)e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(l[k]),
f|=e<<18-6*k;for(k=0;k<l.length-1;k+=1){m=g+b;for(e=m>>>2;a.length<=e;)a.push(0);a[e]|=(f>>>16-8*k&255)<<8*(3-m%4);g+=1}}return{value:a,binLen:8*g+d}}function M(c,b,d){var a=[],g,e,h,a=b||[0];d=d||0;g=d>>>3;for(b=0;b<c.byteLength;b+=1)h=b+g,e=h>>>2,a.length<=e&&a.push(0),a[e]|=c[b]<<8*(3-h%4);return{value:a,binLen:8*c.byteLength+d}}function B(c,b,d){var a="";b/=8;var g,e;for(g=0;g<b;g+=1)e=c[g>>>2]>>>8*(3-g%4),a+="0123456789abcdef".charAt(e>>>4&15)+"0123456789abcdef".charAt(e&15);return d.outputUpper?
a.toUpperCase():a}function C(c,b,d){var a="",g=b/8,e,h,f;for(e=0;e<g;e+=3)for(f=e+1>>>2,h=b/32<=f?0:c[f],f=e+2>>>2,f=b/32<=f?0:c[f],f=(c[e>>>2]>>>8*(3-e%4)&255)<<16|(h>>>8*(3-(e+1)%4)&255)<<8|f>>>8*(3-(e+2)%4)&255,h=0;4>h;h+=1)8*e+6*h<=b?a+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(f>>>6*(3-h)&63):a+=d.b64Pad;return a}function D(c,b){var d="",a=b/8,g,e;for(g=0;g<a;g+=1)e=c[g>>>2]>>>8*(3-g%4)&255,d+=String.fromCharCode(e);return d}function E(c,b){var d=b/8,a,g=new ArrayBuffer(d);
for(a=0;a<d;a+=1)g[a]=c[a>>>2]>>>8*(3-a%4)&255;return g}function A(c){var b={outputUpper:!1,b64Pad:"="};c=c||{};b.outputUpper=c.outputUpper||!1;!0===c.hasOwnProperty("b64Pad")&&(b.b64Pad=c.b64Pad);if("boolean"!==typeof b.outputUpper)throw Error("Invalid outputUpper formatting option");if("string"!==typeof b.b64Pad)throw Error("Invalid b64Pad formatting option");return b}function z(c,b){var d;switch(b){case "UTF8":case "UTF16BE":case "UTF16LE":break;default:throw Error("encoding must be UTF8, UTF16BE, or UTF16LE");
}switch(c){case "HEX":d=J;break;case "TEXT":d=function(a,c,e){var d=[],f=[],n=0,l,m,r,p,q,d=c||[0];c=e||0;r=c>>>3;if("UTF8"===b)for(l=0;l<a.length;l+=1)for(e=a.charCodeAt(l),f=[],128>e?f.push(e):2048>e?(f.push(192|e>>>6),f.push(128|e&63)):55296>e||57344<=e?f.push(224|e>>>12,128|e>>>6&63,128|e&63):(l+=1,e=65536+((e&1023)<<10|a.charCodeAt(l)&1023),f.push(240|e>>>18,128|e>>>12&63,128|e>>>6&63,128|e&63)),m=0;m<f.length;m+=1){q=n+r;for(p=q>>>2;d.length<=p;)d.push(0);d[p]|=f[m]<<8*(3-q%4);n+=1}else if("UTF16BE"===
b||"UTF16LE"===b)for(l=0;l<a.length;l+=1){e=a.charCodeAt(l);"UTF16LE"===b&&(m=e&255,e=m<<8|e>>>8);q=n+r;for(p=q>>>2;d.length<=p;)d.push(0);d[p]|=e<<8*(2-q%4);n+=2}return{value:d,binLen:8*n+c}};break;case "B64":d=L;break;case "BYTES":d=K;break;case "ARRAYBUFFER":try{d=new ArrayBuffer(0)}catch(a){throw Error("ARRAYBUFFER not supported by this environment");}d=M;break;default:throw Error("format must be HEX, TEXT, B64, BYTES, or ARRAYBUFFER");}return d}function w(c,b){return 32<b?(b=b-32,new f(c.b<<
b|c.a>>>32-b,c.a<<b|c.b>>>32-b)):0!==b?new f(c.a<<b|c.b>>>32-b,c.b<<b|c.a>>>32-b):c}function n(c){var b=0,d=0,a;for(a=0;a<arguments.length;a++)b^=arguments[a].b,d^=arguments[a].a;return new f(d,b)}function v(c){var b=[];if(0===c.lastIndexOf("SHA3-",0)||0===c.lastIndexOf("SHAKE",0))for(c=0;5>c;c++)b[c]=[new f(0,0),new f(0,0),new f(0,0),new f(0,0),new f(0,0)];else throw Error("No SHA variants supported");return b}function x(c,b){var d,a,g,e,h=[],k=[];if(null!==c)for(a=0;a<c.length;a+=2)b[(a>>>1)%5][(a>>>
1)/5|0]=n(b[(a>>>1)%5][(a>>>1)/5|0],new f((c[a+1]&255)<<24|(c[a+1]&65280)<<8|(c[a+1]&16711680)>>>8|c[a+1]>>>24,(c[a]&255)<<24|(c[a]&65280)<<8|(c[a]&16711680)>>>8|c[a]>>>24));for(d=0;24>d;d++){e=v("SHA3-");for(a=0;5>a;a++)h[a]=n(b[a][0],b[a][1],b[a][2],b[a][3],b[a][4]);for(a=0;5>a;a++)k[a]=n(h[(a+4)%5],w(h[(a+1)%5],1));for(a=0;5>a;a++)for(g=0;5>g;g++)b[a][g]=n(b[a][g],k[a]);for(a=0;5>a;a++)for(g=0;5>g;g++)e[g][(2*a+3*g)%5]=w(b[a][g],F[a][g]);for(a=0;5>a;a++)for(g=0;5>g;g++)b[a][g]=n(e[a][g],new f(~e[(a+
1)%5][g].a&e[(a+2)%5][g].a,~e[(a+1)%5][g].b&e[(a+2)%5][g].b));b[0][0]=n(b[0][0],G[d])}return b}var F,G;G=[new f(0,1),new f(0,32898),new f(2147483648,32906),new f(2147483648,2147516416),new f(0,32907),new f(0,2147483649),new f(2147483648,2147516545),new f(2147483648,32777),new f(0,138),new f(0,136),new f(0,2147516425),new f(0,2147483658),new f(0,2147516555),new f(2147483648,139),new f(2147483648,32905),new f(2147483648,32771),new f(2147483648,32770),new f(2147483648,128),new f(0,32778),new f(2147483648,
2147483658),new f(2147483648,2147516545),new f(2147483648,32896),new f(0,2147483649),new f(2147483648,2147516424)];F=[[0,36,3,41,18],[1,44,10,45,2],[62,6,43,15,61],[28,55,25,21,56],[27,20,39,8,14]];"function"===typeof define&&define.amd?define(function(){return t}):"undefined"!==typeof exports?"undefined"!==typeof module&&module.exports?module.exports=exports=t:exports=t:H.jsSHA=t})(this);
